function addEndingBackslash(a){return"/"!=a.charAt(a.length-1)?a+"/":a}function ScheduleData(a){if(this.data=a,this.estimatedSchedulePosixTime,this.currentShow=new Array,void 0!=a.currentShow)for(var b=0;b<a.currentShow.length;b++)this.currentShow[b]=new Show(a.currentShow[b]);if(this.nextShows=new Array,void 0!=a.nextShow)for(var b=0;b<a.nextShow.length;b++)this.nextShows[b]=new Show(a.nextShow[b]);this.currentTrack=new AudioTrack(a.current),this.nextTrack=new AudioTrack(a.next),this.schedulePosixTime=convertDateToPosixTime(a.schedulerTime);var c=new Date;this.localRemoteTimeOffset=c.getTime()-this.schedulePosixTime}function Show(a){this.showData=a}function AudioTrack(a){this.trackData=a}function getTime(a){var b=a.split(" ")[1].split(":");return b[0]+":"+b[1]}function convertToHHMMSS(a){var b=parseInt(a),c=parseInt(b/36e5);b-=36e5*c;var d=parseInt(b/6e4);b-=6e4*d;var e=parseInt(b/1e3);return c=c.toString(),d=d.toString(),e=e.toString(),1==c.length&&(c="0"+c),1==d.length&&(d="0"+d),1==e.length&&(e="0"+e),"00"==c?d+":"+e:c+":"+d+":"+e}function convertDateToPosixTime(a){var b=a.split(" "),c=b[0].split("-"),d=b[1].split(":"),e=c[0],f=c[1],g=c[2],h=d[0],i=d[1],j=0,k=0;if(-1!=d[2].indexOf(".")){var l=d[2].split(".");j=l[0],k=l[1]}else j=d[2];return Date.UTC(e,f-1,g,h,i,j,k)}function checkWidgetVersion(a){var b=a.AIRTIME_API_VERSION;if(void 0===b||b>AIRTIME_API_VERSION)throw"The version of widgets you are using is out of date with the Airtime installation, please update your widgets javascript file. (Airtime widget API version is "+b+", this widget's API version is "+AIRTIME_API_VERSION+")";if(AIRTIME_API_VERSION>b)throw"The Airtime server has a different version than this widget supports. Please get the correct widget version for your Airtime installation. (Airtime widget API version is "+b+", this widget's API version is "+AIRTIME_API_VERSION+")"}var AIRTIME_API_VERSION="1.1";!function(a){a.fn.airtimeShowSchedule=function(b){var c={updatePeriod:20,sourceDomain:apiSrc,text:{onAirToday:"On air today"},showLimit:5};return b=a.extend(!0,c,b),b.sourceDomain=addEndingBackslash(b.sourceDomain),this.each(function(){function c(){var a=g.getCurrentShow(),c=g.getNextShows(),d=0==a.length?c:a.concat(c);tableString="",tableString+="<h3>"+b.text.onAirToday+"</h3>",tableString+="<table width='100%' border='0' cellspacing='0' cellpadding='0' class='widget widget now-playing-list small'><tbody>";for(var e=0;e<d.length;e++){tableString+="<tr><td class='time'>"+d[e].getRange()+"</td>";var f=d[e].getURL();f.length>0?tableString+="<td><a href='"+d[e].getURL()+"'>"+d[e].getName()+"</a></td></tr>":tableString+="<td>"+d[e].getName()+"</td></tr>"}tableString+="</tbody></table>",h.empty(),h.append(tableString)}function d(a){checkWidgetVersion(a),g=new ScheduleData(a),c()}function e(a,b,c){}function f(){a.ajax({url:b.sourceDomain+"api/live-info/",data:{type:"endofday",limit:b.showLimit},dataType:"jsonp",success:function(a){d(a)},error:e}),setTimeout(f,1e3*b.updatePeriod)}var g,h=a(this);f()})}}(jQuery),function(a){a.fn.airtimeLiveInfo=function(b){var c={updatePeriod:5,sourceDomain:apiSrc,text:{onAirNow:"Listen <span>Live</span>",offline:"Offline",current:"Current",next:"Next"}};return b=a.extend(!0,c,b),b.sourceDomain=addEndingBackslash(b.sourceDomain),this.each(function(){function c(){if(null!==h){var a=h.getCurrentShow(),c=h.getNextShows(),d=b.text.offline,e="",f="",i="",j="",k="";a.length>0&&(d=b.text.onAirNow,e=a[0].getName(),f=h.getShowTimeElapsed(a[0]),i=h.getShowTimeRemaining(a[0])),c.length>0&&(j=c[0].getName(),k=c[0].getRange()),g.empty(),"On Air Now"==d&&(d="On Air <span>Now</span>"),g.append("<h2>"+d+"</h2>"),g.append("<ul class='widget now-playing-bar'><li class='current'>"+b.text.current+": "+e+"<br /><span id='time-elapsed' class='time-elapsed' title='Elapsed show time'>e "+f+"</span> <span id='time-remaining' class='time-remaining' title='Remaining show time'>r "+i+"</span></li><li class='next'>"+b.text.next+": "+j+"<br /><span>"+k+"</span></li></ul>")}}function d(a){checkWidgetVersion(a),h=new ScheduleData(a)}function e(a,b,c){}function f(){a.ajax({url:b.sourceDomain+"api/live-info/",data:{type:"interval",limit:"5"},dataType:"jsonp",success:function(a){d(a)},error:e}),setTimeout(f,1e3*b.updatePeriod)}var g=a(this),h=null;f(),setInterval(c,1e3)})}}(jQuery),function(a){a.fn.airtimeLiveTrackInfo=function(b){var c={updatePeriod:5,sourceDomain:apiSrc,text:{onAirNow:"Now Playing",offline:"Offline",current:"Current",next:"Next"}};return b=a.extend(!0,c,b),b.sourceDomain=addEndingBackslash(b.sourceDomain),this.each(function(){function c(){if(null!==h){var c=h.getCurrentShow(),d=h.getNextShows(),e=b.text.offline,f="",j="",k="",l="",m="";c.length>0&&(e=b.text.onAirNow,f=c[0].getName(),j=h.getShowTimeElapsed(c[0]),k=h.getShowTimeRemaining(c[0])),d.length>0&&(l=d[0].getName(),m=d[0].getRange()),g.empty();var n;n=1==i?"<button id='playNow' aria-controls='audio' class='playing' title='Begin audio streaming'>Play Now</button>":"<button id='playNow' aria-controls='audio' title='Begin audio streaming'>Play Now</button>",g.append("<h2>Listen <span>Live</span></h2>"+n),g.append("<p class='current track-metadata'>"+b.text.current+": "+h.currentTrack.getTitle()+"</p>"),a(".desktop button").bind("click",function(){i=!0,window.open($url,"playerWindow","toolbar=no, location=no, status=no, menubar=no, scrollbars=no, resizable=no, width=230, height=120")}),a(".mobile button").bind("click",function(){i=!0;var a=streamSrc+":"+port+"/"+stream_b+"?callback=?";window.open(a,"playerWindow")}),a(".player #playNow").bind("click",function(){i=!0;var a=new Audio;a.src=Modernizr.audio.ogg?streamSrc+":"+port+"/"+stream_a+"?callback=?":Modernizr.audio.mp3?streamSrc+":"+port+"/"+stream_b+"?callback=?":a.play(),null!=a.src&&a.play()})}}function d(a){checkWidgetVersion(a),h=new ScheduleData(a)}function e(a,b,c){}function f(){a.ajax({url:b.sourceDomain+"api/live-info/",data:{type:"interval",limit:"5"},dataType:"jsonp",success:function(a){d(a)},error:e}),setTimeout(f,1e3*b.updatePeriod)}var g=a(this),h=null;f(),setInterval(c,1e3);var i=!1})}}(jQuery),function(a){a.fn.airtimeWeekSchedule=function(b){var c={sourceDomain:apiSrc,updatePeriod:600,dowText:{monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",sunday:"Sunday"},miscText:{time:"Time",programName:"Program Name",details:"Details",readMore:"Read More"}};return b=a.extend(!0,c,b),b.sourceDomain=addEndingBackslash(b.sourceDomain),this.each(function(){function c(c){for(var d=0;d<h.length;d++){for(var e='<table class="widget widget now-playing-list"><colgroup><col width="110" /><col width="350" /><col width="240" /></colgroup><thead></thead><tfoot><tr><td></td></tr></tfoot><tbody>',f=c[h[d]],g=0;g<f.length;g++){var i=f[g].url;e+='<tr><td class="time_grid col_two">'+getTime(f[g].start_timestamp)+" - "+getTime(f[g].end_timestamp)+'</td><td class="name_grid"><h4>'+f[g].name+'</h4></td><td class="more_grid">'+(i.length>0?'<a href="'+i+'">'+b.miscText.readMore+"</a>":"")+"</li></td></tr>"}e+="</tbody></table>",a("#tab"+Math.abs(d+1)).empty(),a("#tab"+Math.abs(d+1)).append(e)}}function d(a){checkWidgetVersion(a),c(a)}function e(a,b,c){}function f(){a.ajax({url:b.sourceDomain+"api/week-info/",dataType:"jsonp",success:function(a){d(a)},error:e}),setTimeout(f,1e3*b.updatePeriod)}var g=a(this);g.empty(),g.attr("class","ui-tabs");var h=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],i=new Date,j=i.getDay()-1;0>j&&(j+=7);for(var k='<ul class="tabs">',l=0;l<h.length;l++)k+='<li class="'+b.dowText[h[l]]+(l==j?' active"':'"')+'><span><a href="#tab'+Math.abs(l+1)+'">'+b.dowText[h[l]]+"</a></span></li>";k+='</ul><div class="tab_container">';for(var l=0;l<h.length;l++)k+='<div id="tab'+Math.abs(l+1)+'" class="tab_content '+h[l]+'"></div>';k+="</div>",g.append(k),f(),console.log("airtime week scehdule says apiSrc is "+apiSrc)})}}(jQuery),ScheduleData.prototype.secondsTimer=function(){var a=new Date;this.estimatedSchedulePosixTime=a.getTime()-this.localRemoteTimeOffset},ScheduleData.prototype.getCurrentShow=function(){return this.currentShow},ScheduleData.prototype.getNextShows=function(){return this.nextShows},ScheduleData.prototype.getShowTimeElapsed=function(a){this.secondsTimer();var b=convertDateToPosixTime(a.getStartTimestamp());return convertToHHMMSS(this.estimatedSchedulePosixTime-b)},ScheduleData.prototype.getShowTimeRemaining=function(a){this.secondsTimer();var b=convertDateToPosixTime(a.getEndTimestamp());return convertToHHMMSS(b-this.estimatedSchedulePosixTime)},Show.prototype.getURL=function(){return this.showData.url},Show.prototype.getName=function(){return this.showData.name},Show.prototype.getRange=function(){return getTime(this.showData.start_timestamp)+" - "+getTime(this.showData.end_timestamp)},Show.prototype.getStartTimestamp=function(){return this.showData.start_timestamp},Show.prototype.getEndTimestamp=function(){return this.showData.end_timestamp},AudioTrack.prototype.getTitle=function(){return null===this.trackData?"":this.trackData.name};